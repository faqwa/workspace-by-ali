---
type Status = 'in-progress' | 'completed' | 'blocked' | 'paused';

interface Props {
  title: string;
  date: Date;
  summary: string;
  category: string;
  slug: string;
  status?: Status;
}

const { title, date, summary, category, slug, status } = Astro.props;

const cleanSlug = slug.split('/').pop() || slug;

const formattedDate = date.toLocaleDateString('en-AU', {
  year: 'numeric',
  month: 'short',
  day: 'numeric'
});

const statusColors: Record<Status, string> = {
  'in-progress': '#4a9eff',
  'completed': '#22c55e',
  'blocked': '#ef4444',
  'paused': '#f59e0b'
};

const statusEmoji: Record<Status, string> = {
  'in-progress': 'üîß',
  'completed': '‚úì',
  'blocked': '‚ö†',
  'paused': '‚è∏'
};
---

<article class="card" aria-labelledby={`update-${cleanSlug}`}>
  <a href={`/updates/${slug}`} class="stretched" aria-describedby={`sum-${cleanSlug}`}>
    <header class="card-header">
      <h3 id={`update-${cleanSlug}`} class="title">{title}</h3>
      {status && (
        <span class="status"
          style={`--status:${statusColors[status]}`}>
          <span class="emoji">{statusEmoji[status]}</span>
          {status}
        </span>
      )}
    </header>
    <p class="date">
      <time datetime={date.toISOString()}>{formattedDate}</time>
    </p>
    <p id={`sum-${cleanSlug}`} class="summary">{summary}</p>
  </a>
</article>

<style>
  .card{
    background: var(--elev-2);
    border: 1px solid var(--border-2);
    border-radius: var(--radius-md);
    transition: transform .2s ease, border-color .2s ease, background .2s ease;
    min-width: 320px; max-width: 380px; position:relative;
  }
  .card:hover{ border-color: var(--border-3); background: var(--elev-3); transform: translateY(-1px); }
  .stretched{ display:block; padding:1.5rem; text-decoration:none; color:inherit; }
  .card-header{
    display:flex; justify-content:space-between; align-items:flex-start; gap:1rem; margin-bottom:.5rem;
  }
  .title{
    margin:0; font-size:1.1rem; font-weight:600; color:var(--text-1); letter-spacing:-.01em; line-height:1.4;
  }
  .status{
    font-size:.7rem; padding:.35rem .6rem; border-radius: var(--radius-sm);
    font-weight:600; text-transform:capitalize; display:inline-flex; gap:.35rem; align-items:center;
    background: color-mix(in oklab, var(--status) 15%, transparent); color: var(--status);
    border: 1px solid color-mix(in oklab, var(--status) 35%, transparent);
  }
  .emoji{ font-size:.85rem; }
  .date{ color:var(--text-5); font-size:.85rem; margin:.25rem 0 1rem; }
  .summary{ color:var(--text-3); font-size:.95rem; margin:0; line-height:1.6; }
</style>
