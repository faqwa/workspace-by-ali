---
/**
 * TimelineItem Component - Design System
 *
 * Individual timeline item with marker, content card, and type-based styling
 * Types: project (blue), update (green), edit (orange)
 * Based on /design/activity-log-redesign.html
 */

interface Props {
  type: 'project' | 'update' | 'edit';
  title: string;
  meta?: string;
  timestamp: string;
  description?: string;
  tag?: string;
  class?: string;
}

const {
  type,
  title,
  meta,
  timestamp,
  description,
  tag,
  class: className = '',
} = Astro.props;

// Type-specific marker styles
const markerStyles = {
  project: {
    border: 'border-indigo-500',
    background: 'bg-indigo-50 dark:bg-indigo-950',
    iconColor: 'text-indigo-500',
  },
  update: {
    border: 'border-primary',
    background: 'bg-primary-light dark:bg-primary-dark',
    iconColor: 'text-primary-dark dark:text-primary',
  },
  edit: {
    border: 'border-amber-500',
    background: 'bg-amber-50 dark:bg-amber-950',
    iconColor: 'text-amber-500',
  },
};

// Type-specific tag styles
const tagStyles = {
  project: 'bg-indigo-50 text-indigo-500 dark:bg-indigo-950 dark:text-indigo-400',
  update: 'bg-primary-light text-primary-dark dark:bg-primary-dark dark:text-primary',
  edit: 'bg-amber-50 text-amber-500 dark:bg-amber-950 dark:text-amber-400',
};

// Icons for each type
const icons = {
  project: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
  </svg>`,
  update: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
    <path d="M14 2v6h6"/>
  </svg>`,
  edit: `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
  </svg>`,
};

const markerClasses = [
  'absolute',
  '-left-8', // -32px
  'top-1', // 4px
  'w-8 h-8', // 32px x 32px
  'rounded-full',
  'flex items-center justify-center',
  'bg-white dark:bg-gray-900',
  'border-[3px]',
  markerStyles[type].border,
  markerStyles[type].background,
  markerStyles[type].iconColor,
].filter(Boolean).join(' ');

const containerClasses = [
  'relative',
  'pb-8', // 32px padding-bottom
  'last:pb-0',
  className,
].filter(Boolean).join(' ');
---

<div class={containerClasses}>
  <!-- Timeline Marker -->
  <div class={markerClasses} set:html={icons[type]}></div>

  <!-- Timeline Content Card -->
  <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-[10px] p-4">
    <!-- Header: Title, Meta, and Timestamp -->
    <div class="flex justify-between items-start mb-2">
      <div>
        <div class="text-[15px] font-semibold text-gray-900 dark:text-gray-100 mb-1">
          {title}
        </div>
        {meta && (
          <div class="text-[13px] text-gray-500 dark:text-gray-400">
            {meta}
          </div>
        )}
      </div>
      <div class="text-[13px] text-gray-400 dark:text-gray-500">
        {timestamp}
      </div>
    </div>

    <!-- Description -->
    {description && (
      <div class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
        {description}
      </div>
    )}

    <!-- Optional Tag -->
    {tag && (
      <span class={`inline-block px-2.5 py-1 rounded-md text-xs font-medium mt-2 ${tagStyles[type]}`}>
        {tag}
      </span>
    )}

    <!-- Slot for custom content -->
    <slot />
  </div>
</div>
